---
layout: doc
title: "Обновление"
description: "Обновление сайта на Jekyll. Изменения в jekyll третьей версии."
prism: yes
---
## Обновление с версии 2.x до 3.x 

В версии 3.0, вышедшей осенью 2015 года добавлен целый ряд важных изменений:

* инкрементальная сборка, то есть сборка только измененных страниц сайта, доступна с флагом `--incremental` в качестве экспериментальной возможности
* профилировщик Liquid
* API хуков для разработки плагинов
* уменьшено количество зависимостей с 14 до 8
* прекращена поддержка  Ruby 1.9.3, добавлена поддержка Ruby 2.2 и базовая поддержка JRuby 
* удален процессор markdown maruku

### Изменения коллекций

В версии 2.x при итерации через `site.collections`, каждая коллекция была массивом, первый элемент которой был меткой коллекции, а вторым элемент объект коллекции. В версии 3.x  эта сложность устранена и итерация проходит только через сам объект коллекции, теперь:

* `collection[0]` это `collection.label`
* `collection[1]` это `collection`

Учитывайте это в ваших шаблонах при итерации `site.collections`.

### Исключенные зависимости

Многие пакеты, ранее включавшиеся в ядро, теперь стали опциональными. Теперь для их использования их надо установить и подключить в `_config.yml`. Это следующие пакеты:

* `jekyll-paginate` – модуль Jekyll для разбивки на страницы
* `jekyll-coffeescript` – процессор CoffeeScript
* `jekyll-gist` – тег  Liquid `gist`
* `pygments.rb` – подсветчик синтаксиса Pygments
* `redcarpet` –  процессор Markdown
* `toml` –  альтернативный  YAML формат конфигурационных файлов
* `classifier-reborn` – длч выборки связанных постов `site.related_posts`

### Отложенные посты

В версии 2.x флаг `--future` был по умолчанию активирован. Этот флаг позволяет авторам датировать посты будущим временем и исключать эти посты из сборки до его наступления. Сейчас этот флаг по умолчанию отключен и это значит, что если вы хотите сгенерировать отложенные посты, вам надо прямо указать опцию  `--future` при выполнении `jekyll build` или `jekyll serve`.

### Метаданные макетов

В Jekyll 2 и ниже все метаданные макетов терялись для переменной `page`. Это влекло множество недоразумений при вложении макетов и влекло неожиданное поведение. В Jekyll 3 все данные макетов доступны через переменную `layout`. Например, если во вводной макета есть `class: my-layout`, эти данные можно извлечь через `layout.class`.

### Смена подсветчика синтаксиса

В третье версии Rouge заменил Pygments в качестве подсветчика и тепеоь некоторые функции тега `highlight` не работают по умолчанию, например, `hl_lines`. Чтобы вернуться к Pygments, вам надо добавить в `_config.yml` строчку `highlighter: pygments` и установить гем  командой `gem install pygments.rb` или добавить в гемфайл проекта `gem 'pygments.rb'`.

## Обновление с версии 0.x до 2.x 

Как обновить старую версию Jekyll? Некоторые вещи поменялись со времени версии 1.0 и вам стоит узнать об этом.

Для начала установите последнюю версию Jekyll на компьютер:

```bash
$ gem update jekyll
```

###### Простой вариант
{: .protip}
Хотите быстро создать новый сайт на Jekyll? Просто выполните команду `jekyll new SITENAME`, чтобы создать новый каталог с заготовкой сайта
{: .protip}

### Команда Jekyll

Для ясности --- Jekyll принимает команды `build ` и`serve`. Если раньше вы просто запускали команду `Jekyll` для генерации сайта и `jekyll --server` для локального предпросмотра сайта, то с версии 2.0 вы используете для этого субкоманды `jekyll build` и `jekyll serve`.

###### Локальный сервер
{: .info}
С новыми субкомандами предпросмотр локальных сайтов немного изменился. Вместо задания  в конфигурации ` server: true` используйте `jekyll serve`. То же относится и к `watch: true` используйте флаг `--watch`  с `jekyll serve` или  `jekyll build`
{: .info}

### Абсолютные пермалинки

В Jekyll v1.0 впервые появились абсолютные пермалинки для страниц в подкаталогах. Начиная с версии 2.0, абсолютные пермалинки стали дефолтными вместо относительных. Обратная совместимость относительных пермалинков будет удалена в версии 3.0.

###### Абсолютные пермалинки будут обязательными с версии 3.0
{: .warning}
Начиная с версии Jekyll 3.0 относительные пермалинки будут полностью удалены и станут недоступными для использования
{: .warning}

### Черновики

В Jekyll есть возможность создания черновиков с локальным предпросмотром. Для создания черновика просто создайте каталог `_drafts` в основном каталоге сайта и добавьте туда новый файл с разметкой. Для предпросмотра черновиков просто выполните `jekyll serve` с флагом `--drafts`.

###### У черновиков нет дат
{: .info}
В отличие от постов, черновики не датируются, так как они не опубликованы. Поэтому вместо стандартного именования `2013-07-01-my-draft-post.md` именуйте черновики просто по названию поста `my-draft-post.md`
{: .info}

### Кастомный файл конфигурации

Вместо задания индивидуальных флагов при запуске вы можете передать целый кастомный файл с конфигурацией. Это упрощает разделение между окружениями и позволяет вам программно переопределять умолчания. Просто добавьте флаг `--config` к команде `jekyll` и путь к одному или нескольким конфигурационным файлам.

Соответственно, следующие старые флаги командной строки сейчас запрещены:

Permalink

* `--no-server`
* `--no-auto` (сейчас `--no-watch`)
* `--auto` (сейчас `--watch`)
* `--server`
* `--url=`
* `--maruku`, `--rdiscount` и `--redcarpet`
* `--pygments`
* `--permalink=`
* `--paginate`

###### Флаг `--config` явно указывает конфигурационный файл
{: .info}
Если вы используете флаг `--config`, Jekyll будет игнорировать ваш файл `_config.yml`. Хотите совместить кастомную конфигурацию с обычной? Не проблема, Jekyll принимает больше одного файла при конфигурации в командной строке. Файлы конфигурации каскадируются справа налево, поэтому команда `jekyll serve --config _config.yml,_config-dev.yml`  позволит файлу `_config-dev.yml` переписать настройки `_config.yml`, когда они содержат один ключ
{: .info}

### Новые опции конфигурационного файла

В Jekyll 1.0 представлено несколько новых опций конфигурационного файла. Перед обновлением проверьте, присутствуют ли они в вашем старом файле конфигурации  и если да, убедитесь, что вы используете их правильно:

* `excerpt_separator`
* `host`
* `include`
* `keep_files`
* `layouts`
* `show_drafts`
* `timezone`
* `url`

### Базовый URL

У многих возникает желание запускать сайт на Jekyll в различных местах, например локально просматривать перед развертыванием на GitHub Pages. Jekyll 1.0 облегчает это с новым флагом `--baseurl`. Чтобы использовать преимущества этой фичи, сначала добавьте `baseurl` продакшен-версии вашего сайта в `_config.yml`. Затем на всем сайте добавьте относительный URL префикс {% raw %}`{{ site.baseurl }}`{% endraw %}. А для локального предпросмотра передайте `--baseurl` с локальным базовым URL (обычно это `/`) команде `jekyll serve`  и все ваши ссылки будут работать правильно в обоих окружениях.

###### !!Все URL страниц и постов содержат открывающий слэш
{: .warning}
Если вы используете метод, указанный выше, запомните, что все URL страниц и постов содержат открывающий слэш. А значит, конкатенация базового URL c URL поста, где `site.baseurl = /` и `post.url = /2013/06/05/my-fun-post/` даст в результате два открывающих слэша, что поломает ссылки. Таким образом предполагается, что префикс `site.baseurl` используется тогда, когда `baseurl` отличается от дефолтного `/`.
{: .warning}
